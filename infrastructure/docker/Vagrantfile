# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
    config.vm.define "docker-1" do |d|
        # Ubuntu 20.04.3 LTS - Focal Fossa
        d.vm.box = "ubuntu/focal64"
#         d.vm.network "forwarded_port", guest: 80, host: 8080
#         d.vm.network "forwarded_port", guest: 20, host: 20
        d.vm.network "forwarded_port", guest: 21, host: 21

        for i in 21000..21010
            config.vm.network :forwarded_port, guest: i, host: i
        end

        d.vm.provider "virtualbox" do |vb|
            vb.name = "docker-1"
            vb.gui = true
            vb.memory = "4048"
        end

#         d.vm.provider "docker" do |dp|
#             dp.volumes = ["/var:/ftp"]
#         end

        d.vm.provision "shell", inline: <<-SHELL
            sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
            sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
            echo -e "root\nroot" | passwd root
            systemctl restart sshd.service
        SHELL

        d.vm.provision :docker do |dc|
            dc.build_image "/vagrant", args: "-t my-name/my-new-image"
            dc.run "my-name/my-new-image", args: "-p 21:21"
        end
    end
end